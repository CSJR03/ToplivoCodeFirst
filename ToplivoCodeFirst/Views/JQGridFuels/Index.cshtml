@{
    ViewBag.Title = "Виды топлива";

}

<h2>Виды топлива (JQGrid)</h2>


<table id="jqg"></table>
<div id="jpager"></div>
@section scripts{
    <script src="~/Scripts/jquery-3.1.0.min.js" type="text/javascript"></script>
    <link href="~/Content/themes/base/jquery.ui.all.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/jquery.jqGrid/ui.jqgrid.css" rel="stylesheet" type="text/css" />
    <script src="~/Scripts/jquery.jqGrid.min.js" type="text/javascript"></script>
    <script src="~/Scripts/i18n/grid.locale-ru.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function () {
    $("#jqg").jqGrid({
        url: '@Url.Action("GetFuels")',
        datatype: "json",
        colNames: ['FuelID', 'Вид топлива', 'Плотность'],
        colModel: [
        { name: 'FuelID', index: 'FuelID', width: 30, stype: 'text', key: true },
        { name: 'FuelType', index: 'FuelType', width: 150, editable: true, edittype: 'text', sortable: true },
        { name: 'FuelDensity', index: 'FuelDensity', width: 150, editable: true, edittype: 'text', sortable: true },
       
        ],
        rowNum: 10,
        rowList: [10, 20, 30],
        width:760,
        pager: '#jpager',
        loadonce:true,
        sortname: 'FuelType',
        sortorder: "desc",
        height: '100%',
        viewrecords: true,
        caption: 'Виды топлива',
        emptyrecords: 'Нет видов топлива для отображения',
        autowidth: true,
    });
    $("#jqg").jqGrid('navGrid', '#jpager', {

        search: true,
        searchtext: "Поиск",
        refresh: true,
        refreshtext: "Обновить",
        add: true,
        del: true,
        edit: true,
        view: true,
        viewtext: "Смотреть",
        viewtitle: "Выбранная запись",
        addtext: "Добавить",
        edittext: "Изменить",
        deltext: "Удалить"
    },
    update("edit"),
    update("add"),
    update("del")
    );
    function update(act) {
        return {
            closeAfterAdd: true,
            height: 230,
            width: 400,
            closeAfterEdit: true,
            reloadAfterSubmit: true,
            drag: true,
            onclickSubmit: function (params) {
                var list = $("#jqg");
                var selectedRow = list.getGridParam("selrow");
                rowData = list.getRowData(selectedRow);
                if (act === "add")
                    params.url= '@Url.Action("Create")';
                else if (act === "del") {
                    params.url = '@Url.Action("Delete")';
                    var selectedrowindex = jQuery("#grid").jqGrid('getGridParam', 'selrow');
                    var dataFromCellByColumnIndex = jQuery('#grid').jqGrid('getCell', selectedrowindex, 1);
                    params.serializeDelData = rowData.Id;

                    console.log(rowData.Id);
                }
                else if (act === "edit")
                    params.url = '@Url.Action("Edit")';
            },
            afterSubmit: function (response, postdata) {
                $(this).jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid')
                return [true, "", 0]
            }
        };
    };
});
</script>

}













